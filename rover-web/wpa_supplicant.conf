########################################
# Rover WiFi Configuration - Optimized for Reliable Roaming
########################################
# Deploy to: /etc/wpa_supplicant/wpa_supplicant.conf
# Restart: sudo systemctl restart wpa_supplicant

ctrl_interface=DIR=/var/run/wpa_supplicant GROUP=netdev
update_config=1
country=US

# Optional global settings (uncomment to enable)
# ap_scan=1  # Active scanning mode
# fast_reauth=1  # Fast reauthentication
# pmf=1  # Protected Management Frames (802.11w)
# okc=1  # Opportunistic Key Caching

network={
    ssid="z26"
    # Pre-computed PSK hash (generated with wpa_passphrase)
    # To generate: wpa_passphrase "z26" "your_password"
    psk=1d3a9313118a65ad8ff1fa5d308fd0edb4ad53131f0c4a744beeb77dc53ed1ff
    key_mgmt=WPA-PSK
    
    # Scan even if SSID is hidden
    scan_ssid=1
    
    #############################################
    # CRITICAL: Background Scanning Configuration
    #############################################
    # This is the KEY to reliable roaming
    # Format: "method:short_interval:signal_threshold:long_interval"
    #
    # Current setting: "simple:30:-65:300"
    # - short_interval: scan every 30 seconds when signal is weak
    # - signal_threshold: -65 dBm (AGGRESSIVE - triggers when signal drops below -65)
    # - long_interval: scan every 300 seconds (5 min) when signal is good
    #
    # This means:
    # - When RSSI > -65 dBm: scan every 5 minutes (low overhead)
    # - When RSSI < -65 dBm: scan every 30 seconds (proactive)
    # - wpa_supplicant will automatically roam to better APs
    #
    # Tuning guide:
    # - More aggressive: "simple:30:-60:300" or "simple:15:-65:180"
    # - More conservative: "simple:60:-70:600" or "simple:30:-75:300"
    #
    bgscan="simple:30:-65:300"
    
    
    #############################################
    # Optional: Enhanced Security (uncomment to enable)
    #############################################
    # key_mgmt=WPA-PSK WPA-PSK-SHA256  # Add SHA256 support
    # proto=RSN  # Force WPA2
    # pairwise=CCMP  # Force AES encryption
    # group=CCMP
    # ieee80211w=1  # Protected Management Frames (802.11w)
    # proactive_key_caching=1  # Faster roaming with OKC
    
    #############################################
    # Optional: Roaming Optimization (uncomment to enable)
    #############################################
    # Scan only on specific channels (faster scans)
    # 2.4GHz: channels 1, 6, 11
    # 5GHz: common channels
    # scan_freq=2412 2437 2462 5180 5200 5220 5240 5260 5280 5300 5320
    
    # Priority (higher number = preferred network)
    # priority=10
}

#############################################
# Optional: Fallback to Open Network (if needed)
#############################################
# network={
#     ssid="BACKUP_NETWORK"
#     key_mgmt=NONE
#     priority=1
# }

#############################################
# Deployment Instructions
#############################################
# 1. This file is configured for network "z26"
# 2. To use with a different network:
#    a. Generate PSK: wpa_passphrase "your_ssid" "your_password"
#    b. Replace ssid and psk values above
# 3. Copy to /etc/wpa_supplicant/wpa_supplicant.conf
#    sudo cp wpa_supplicant.conf.example /etc/wpa_supplicant/wpa_supplicant.conf
# 4. Set permissions: sudo chmod 600 /etc/wpa_supplicant/wpa_supplicant.conf
# 5. Restart service: sudo systemctl restart wpa_supplicant
# 6. Verify: wpa_cli -i wlan0 status
#    Look for: bgscan=simple:30:-65:300 in output
