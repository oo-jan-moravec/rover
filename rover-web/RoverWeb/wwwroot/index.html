<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta
      name="viewport"
      content="width=device-width,initial-scale=1"
    />
    <meta
      http-equiv="Cache-Control"
      content="no-cache, no-store, must-revalidate"
    />
    <meta
      http-equiv="Pragma"
      content="no-cache"
    />
    <meta
      http-equiv="Expires"
      content="0"
    />
    <title>Rover Control</title>
    <script
      src="https://kit.fontawesome.com/1d4131bbf4.js"
      crossorigin="anonymous"
    ></script>
    <style>
      * {
        box-sizing: border-box;
        margin: 0;
        padding: 0;
      }
      body {
        font-family: system-ui, -apple-system, sans-serif;
        background: #0f1419;
        color: #e6edf3;
        height: 100vh;
        overflow: hidden;
        display: flex;
        flex-direction: column;
      }
      .header {
        padding: 10px 16px;
        border-bottom: 1px solid #30363d;
        display: flex;
        justify-content: space-between;
        align-items: center;
        gap: 12px;
        flex-wrap: wrap;
      }
      .header-left {
        display: flex;
        align-items: center;
        gap: 16px;
      }
      h1 {
        font-size: 18px;
        font-weight: 600;
        color: #f0f6fc;
      }
      .header-right {
        display: flex;
        align-items: center;
        gap: 12px;
      }
      .status {
        font-family: ui-monospace, monospace;
        font-size: 12px;
        color: #8b949e;
      }
      /* Role status in header */
      .role-badge {
        display: flex;
        align-items: center;
        gap: 6px;
        padding: 6px 12px;
        border-radius: 6px;
        font-size: 12px;
        font-weight: 500;
      }
      .role-badge.operator {
        background: rgba(46, 160, 67, 0.2);
        border: 1px solid #2ea043;
        color: #3fb950;
      }
      .role-badge.spectator {
        background: rgba(210, 153, 34, 0.2);
        border: 1px solid #d29922;
        color: #e3b341;
      }
      .role-badge .role-icon {
        font-size: 14px;
      }
      .header-btn {
        padding: 6px 12px;
        border-radius: 6px;
        border: 1px solid #30363d;
        background: #21262d;
        color: #e6edf3;
        font-size: 12px;
        font-weight: 500;
        cursor: pointer;
        transition: all 0.2s;
        display: flex;
        align-items: center;
        gap: 6px;
      }
      .header-btn:hover {
        background: #30363d;
        border-color: #444c56;
      }
      .header-btn:active {
        transform: scale(0.98);
      }
      .header-btn.claim {
        background: #1f6feb;
        border-color: #388bfd;
        color: #fff;
      }
      .header-btn.claim:hover {
        background: #388bfd;
      }
      .header-btn.hidden {
        display: none;
      }
      .header-btn.request {
        background: #1f6feb;
        border-color: #388bfd;
        color: #fff;
      }
      .header-btn.request:hover {
        background: #388bfd;
      }
      .header-btn.request.pending {
        background: #6e7681;
        border-color: #6e7681;
        cursor: wait;
      }
      .header-btn.release {
        background: rgba(139, 148, 158, 0.15);
        border-color: #6e7681;
        color: #8b949e;
      }
      .header-btn.release:hover {
        background: rgba(139, 148, 158, 0.25);
      }
      .header-btn.accept {
        background: rgba(46, 160, 67, 0.2);
        border-color: #2ea043;
        color: #3fb950;
      }
      .header-btn.accept:hover {
        background: rgba(46, 160, 67, 0.3);
      }
      .header-btn.deny {
        background: rgba(248, 81, 73, 0.15);
        border-color: #f85149;
        color: #f85149;
      }
      .header-btn.deny:hover {
        background: rgba(248, 81, 73, 0.25);
      }
      .header-actions {
        display: flex;
        align-items: center;
        gap: 8px;
        position: relative;
      }
      /* Disconnect overlay - centered on video */
      .disconnect-overlay {
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: rgba(15, 20, 25, 0.9);
        display: none;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        gap: 12px;
        z-index: 90;
      }
      .disconnect-overlay.visible {
        display: flex;
      }
      .disconnect-icon {
        font-size: 48px;
        color: #f85149;
        animation: pulse 2s ease-in-out infinite;
      }
      @keyframes pulse {
        0%,
        100% {
          opacity: 1;
        }
        50% {
          opacity: 0.4;
        }
      }
      .disconnect-title {
        font-size: 24px;
        font-weight: 600;
        color: #f85149;
      }
      .disconnect-status {
        font-size: 14px;
        color: #8b949e;
      }
      /* Request overlay - centered on video */
      .request-overlay {
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        display: none;
        flex-direction: column;
        align-items: center;
        gap: 12px;
        padding: 20px 28px;
        background: rgba(22, 27, 34, 0.95);
        border: 2px solid #d29922;
        border-radius: 12px;
        box-shadow: 0 8px 32px rgba(0, 0, 0, 0.6);
        z-index: 100;
        text-align: center;
      }
      .request-overlay.visible {
        display: flex;
      }
      .request-overlay-title {
        font-size: 16px;
        font-weight: 600;
        color: #e3b341;
      }
      .request-overlay-actions {
        display: flex;
        gap: 12px;
      }
      .request-overlay-btn {
        padding: 10px 20px;
        border-radius: 6px;
        border: none;
        font-size: 14px;
        font-weight: 500;
        cursor: pointer;
        transition: all 0.2s;
        display: flex;
        align-items: center;
        gap: 8px;
      }
      .request-overlay-btn.accept {
        background: #2ea043;
        color: #fff;
      }
      .request-overlay-btn.accept:hover {
        background: #3fb950;
      }
      .request-overlay-btn.deny {
        background: #21262d;
        border: 1px solid #f85149;
        color: #f85149;
      }
      .request-overlay-btn.deny:hover {
        background: rgba(248, 81, 73, 0.15);
      }
      /* Cooldown button styles */
      .header-btn.request {
        position: relative;
        overflow: hidden;
      }
      .header-btn.request.cooldown {
        background: #21262d;
        border-color: #30363d;
        color: #6e7681;
        cursor: not-allowed;
      }
      .header-btn.request .cooldown-bar {
        position: absolute;
        bottom: 0;
        left: 0;
        height: 3px;
        background: #388bfd;
        transition: width 0.1s linear;
      }
      .main-grid {
        display: grid;
        grid-template-columns: 1fr 400px;
        grid-template-rows: auto auto auto auto;
        gap: 12px;
        padding: 12px;
        flex: 1;
        overflow: hidden;
      }
      .camera-section {
        grid-row: 1 / 5;
        background: #161b22;
        border: 1px solid #30363d;
        border-radius: 8px;
        padding: 16px;
        display: flex;
        flex-direction: column;
      }
      .video-container {
        flex: 1;
        position: relative;
        overflow: hidden;
        border-radius: 8px;
        border: 2px solid #30363d;
        background: #0d1117;
        min-height: 200px;
      }
      .video-container iframe {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        border: 0;
      }
      .log-overlay {
        position: absolute;
        inset: 0;
        pointer-events: none;
        display: none;
        padding: 10px;
        font-family: "IBM Plex Mono", "SFMono-Regular", Consolas, monospace;
        font-size: 0.85rem;
        line-height: 1.2;
        color: #b6ff82;
        z-index: 4;
      }
      .log-overlay.visible {
        display: block;
      }
      .log-overlay-inner {
        display: flex;
        flex-direction: column;
        justify-content: flex-end;
        gap: 4px;
        height: 100%;
        overflow: hidden;
      }
      .log-line {
        padding: 2px 6px;
        border-left: 2px solid #7dff6c;
        text-shadow: 0 0 6px rgba(0, 255, 128, 0.4);
      }
      .log-line.warn {
        border-color: #ffb347;
        color: #ffe0a3;
      }
      .log-line.error {
        border-color: #ff6b6b;
        color: #ffc1c1;
      }
      .log-line .log-time {
        margin-right: 8px;
        opacity: 0.85;
      }
      .log-line .log-detail {
        display: block;
        font-size: 0.78em;
        opacity: 0.85;
      }
      .log-repeat-badge {
        display: inline-block;
        margin-left: 8px;
        padding: 2px 6px;
        background: rgba(255, 255, 255, 0.2);
        border-radius: 10px;
        font-size: 0.7em;
        font-weight: 600;
        opacity: 0.8;
        min-width: 20px;
        text-align: center;
      }
      .log-line.warn .log-repeat-badge {
        background: rgba(255, 179, 71, 0.3);
      }
      .log-line.error .log-repeat-badge {
        background: rgba(255, 107, 107, 0.3);
      }
      .controls-section {
        position: relative;
        background: #161b22;
        border: 1px solid #30363d;
        border-radius: 8px;
        padding: 16px;
        display: flex;
        flex-direction: column;
        align-items: center;
        gap: 16px;
      }
      .joystick {
        position: relative;
        width: 250px;
        height: 250px;
        border-radius: 50%;
        background: #0d1117;
        border: 2px solid #30363d;
        touch-action: none;
        user-select: none;
      }
      .joystick-base {
        position: absolute;
        top: 50%;
        left: 50%;
        width: 100px;
        height: 100px;
        margin: -50px 0 0 -50px;
        border-radius: 50%;
        background: #21262d;
        border: 2px solid #444c56;
        pointer-events: none;
      }
      .joystick-handle {
        position: absolute;
        top: 50%;
        left: 50%;
        width: 100px;
        height: 100px;
        margin: -50px 0 0 -50px;
        border-radius: 50%;
        background: linear-gradient(135deg, #2ea043 0%, #1f6e2e 100%);
        border: 3px solid #3fb950;
        cursor: grab;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.5);
        transition: transform 0.05s ease-out;
      }
      .joystick-handle.active {
        cursor: grabbing;
        transform: scale(1.05);
      }
      /* Light buttons - circular, absolute positioned in corner */
      .light-controls {
        position: absolute;
        top: 12px;
        right: 12px;
        display: flex;
        flex-direction: column;
        gap: 12px;
        z-index: 10;
      }
      /* Audio buttons - circular, absolute positioned on left side */
      .audio-controls {
        position: absolute;
        top: 12px;
        left: 12px;
        display: flex;
        flex-direction: column;
        gap: 12px;
        z-index: 10;
      }
      .light-btn {
        width: 52px;
        height: 52px;
        border-radius: 50%;
        background: #21262d;
        border: 2px solid #30363d;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        color: #8b949e;
        cursor: pointer;
        transition: all 0.2s;
        position: relative;
      }
      .light-btn:hover {
        background: #30363d;
        border-color: #444c56;
      }
      .light-btn:active {
        transform: scale(0.95);
      }
      .light-btn.active {
        background: #1a3a1a;
        border-color: #3fb950;
        color: #3fb950;
        box-shadow: 0 0 12px rgba(63, 185, 80, 0.4);
      }
      .light-btn.ir.active {
        background: rgba(248, 81, 73, 0.1);
        border-color: #f85149;
        color: #f85149;
        box-shadow: 0 0 12px rgba(248, 81, 73, 0.4);
      }
      .light-btn i {
        font-size: 22px;
      }
      .light-btn-label {
        font-size: 9px;
        font-weight: 700;
        text-transform: uppercase;
        margin-top: -2px;
        position: absolute;
        bottom: 6px;
      }
      .light-btn.disabled {
        opacity: 0.4;
        cursor: not-allowed;
        pointer-events: none;
      }
      /* Audio buttons - same style as light buttons */
      .audio-btn {
        width: 52px;
        height: 52px;
        border-radius: 50%;
        background: #21262d;
        border: 2px solid #30363d;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        color: #8b949e;
        cursor: pointer;
        transition: all 0.2s;
        position: relative;
      }
      .audio-btn:hover {
        background: #30363d;
        border-color: #444c56;
      }
      .audio-btn:active {
        transform: scale(0.95);
      }
      .audio-btn.ptt.active {
        background: rgba(248, 81, 73, 0.2);
        border-color: #f85149;
        color: #f85149;
        box-shadow: 0 0 12px rgba(248, 81, 73, 0.4);
        animation: pulse-ptt 1s ease-in-out infinite;
      }
      @keyframes pulse-ptt {
        0%,
        100% {
          opacity: 1;
        }
        50% {
          opacity: 0.7;
        }
      }
      .audio-btn.mute.active {
        background: rgba(248, 81, 73, 0.2);
        border-color: #f85149;
        color: #f85149;
        box-shadow: 0 0 12px rgba(248, 81, 73, 0.4);
      }
      .audio-btn.horn {
        background: #21262d;
        border-color: #30363d;
        color: #8b949e;
      }
      .audio-btn.horn:hover {
        background: #30363d;
        border-color: #444c56;
      }
      .audio-btn.horn.active {
        background: rgba(88, 166, 255, 0.2);
        border-color: #58a6ff;
        color: #58a6ff;
        box-shadow: 0 0 12px rgba(88, 166, 255, 0.4);
      }
      .audio-btn.horn:active {
        transform: scale(0.95);
      }
      .audio-btn i {
        font-size: 22px;
      }
      .audio-btn.disabled {
        opacity: 0.4;
        cursor: not-allowed;
        pointer-events: none;
      }
      .motor-values {
        display: flex;
        gap: 24px;
        font-family: ui-monospace, monospace;
      }
      .motor-value {
        text-align: center;
      }
      .motor-label {
        font-size: 10px;
        color: #6e7681;
        text-transform: uppercase;
        letter-spacing: 0.5px;
        margin-bottom: 4px;
      }
      .motor-num {
        font-size: 20px;
        font-weight: 700;
        color: #58a6ff;
      }
      .knobs-section {
        display: flex;
        gap: 16px;
        justify-content: center;
        flex-wrap: wrap;
      }
      .knob-container {
        display: flex;
        flex-direction: column;
        align-items: center;
        gap: 8px;
      }
      .knob {
        width: 60px;
        height: 60px;
        position: relative;
        cursor: pointer;
      }
      .knob-circle {
        width: 100%;
        height: 100%;
        border-radius: 50%;
        background: linear-gradient(145deg, #1f2428 0%, #161b22 100%);
        border: 2px solid #30363d;
        box-shadow: inset 0 2px 4px rgba(0, 0, 0, 0.5),
          0 2px 8px rgba(0, 0, 0, 0.3);
        position: relative;
      }
      .knob-indicator {
        position: absolute;
        top: 8px;
        left: 50%;
        width: 3px;
        height: 20px;
        background: #58a6ff;
        transform-origin: center 22px;
        border-radius: 2px;
        margin-left: -1.5px;
      }
      .knob-label {
        font-size: 11px;
        color: #8b949e;
        text-align: center;
        font-weight: 500;
      }
      .knob-value {
        font-family: ui-monospace, monospace;
        font-size: 12px;
        color: #58a6ff;
        font-weight: 600;
      }
      .diagnostics-section {
        background: #161b22;
        border: 1px solid #30363d;
        border-radius: 8px;
        padding: 10px;
        display: flex;
        flex-direction: column;
        gap: 8px;
      }
      .diag-header {
        font-size: 10px;
        font-weight: 600;
        color: #8b949e;
        text-transform: uppercase;
        letter-spacing: 0.5px;
        margin-bottom: 2px;
      }
      .diag-grid {
        display: flex;
        flex-wrap: wrap;
        gap: 8px;
        margin-bottom: 0;
      }
      .control-grid {
        display: flex;
        flex-wrap: wrap;
        gap: 8px;
      }
      .diag-card {
        background: #0d1117;
        border: 1px solid #30363d;
        border-radius: 4px;
        padding: 6px 10px;
        display: flex;
        flex-direction: row;
        align-items: center;
        gap: 6px;
      }
      .control-card {
        background: #0d1117;
        border: 1px solid #30363d;
        border-radius: 4px;
        padding: 8px 12px;
        display: flex;
        flex-direction: row;
        align-items: center;
        gap: 8px;
        cursor: pointer;
        transition: all 0.2s;
        user-select: none;
      }
      .control-card:hover {
        background: #161b22;
        border-color: #444c56;
      }
      .control-card.active {
        background: #1a2942;
        border-color: #58a6ff;
        box-shadow: 0 2px 8px rgba(88, 166, 255, 0.3);
      }
      .control-card:active {
        transform: scale(0.98);
      }
      .control-icon {
        font-size: 18px;
        color: #8b949e;
      }
      .control-card.active .control-icon {
        color: #58a6ff;
      }
      .control-label {
        font-size: 10px;
        color: #6e7681;
        text-transform: uppercase;
      }
      .control-card.active .control-label {
        color: #58a6ff;
      }
      .control-card.disabled {
        opacity: 0.4;
        cursor: not-allowed;
        pointer-events: none;
      }
      .joystick.disabled {
        opacity: 0.4;
        pointer-events: none;
      }
      .joystick-handle.disabled {
        opacity: 0.4;
        pointer-events: none;
        cursor: not-allowed !important;
      }
      .knob.disabled {
        opacity: 0.4;
        pointer-events: none;
      }
      .diag-label {
        font-size: 9px;
        color: #6e7681;
        text-transform: uppercase;
      }
      .diag-value {
        font-family: ui-monospace, monospace;
        font-size: 13px;
        font-weight: 600;
        color: #58a6ff;
      }
      .diag-value-small {
        font-size: 11px;
        word-break: break-all;
      }
      .diag-unit {
        font-size: 9px;
        color: #6e7681;
        margin-left: 1px;
      }
      /* Wi-Fi Safety State Banner - Expandable */
      .wifi-state-banner {
        border-radius: 6px;
        margin-bottom: 8px;
        background: rgba(46, 160, 67, 0.15);
        border: 1px solid #2ea043;
        transition: all 0.3s ease;
        overflow: hidden;
      }
      .wifi-state-header {
        display: flex;
        align-items: center;
        gap: 10px;
        padding: 8px 12px;
        cursor: pointer;
        user-select: none;
      }
      .wifi-state-header:hover {
        background: rgba(255, 255, 255, 0.03);
      }
      .wifi-state-expand {
        font-size: 10px;
        color: #6e7681;
        margin-left: auto;
        transition: transform 0.2s;
      }
      .wifi-state-banner.expanded .wifi-state-expand {
        transform: rotate(180deg);
      }
      .wifi-state-details {
        max-height: 0;
        overflow: hidden;
        transition: max-height 0.3s ease;
        border-top: 1px solid transparent;
      }
      .wifi-state-banner.expanded .wifi-state-details {
        max-height: 300px;
        border-top-color: rgba(48, 54, 61, 0.5);
      }
      .wifi-state-details-inner {
        padding: 8px 12px;
      }
      .wifi-state-banner.ok {
        background: rgba(46, 160, 67, 0.15);
        border-color: #2ea043;
      }
      .wifi-state-banner.ok .wifi-state-icon {
        color: #3fb950;
      }
      .wifi-state-banner.degraded {
        background: rgba(210, 153, 34, 0.2);
        border-color: #d29922;
      }
      .wifi-state-banner.degraded .wifi-state-icon {
        color: #e3b341;
      }
      .wifi-state-banner.roaming {
        background: rgba(227, 116, 50, 0.2);
        border-color: #e37432;
        animation: pulse-roaming 1s ease-in-out infinite;
      }
      .wifi-state-banner.roaming .wifi-state-icon {
        color: #f0883e;
      }
      @keyframes pulse-roaming {
        0%,
        100% {
          opacity: 1;
        }
        50% {
          opacity: 0.6;
        }
      }
      .wifi-state-banner.offline {
        background: rgba(248, 81, 73, 0.2);
        border-color: #f85149;
      }
      .wifi-state-banner.offline .wifi-state-icon {
        color: #f85149;
      }
      .wifi-state-icon {
        font-size: 18px;
        width: 24px;
        text-align: center;
      }
      .wifi-state-info {
        flex: 1;
      }
      .wifi-state-label {
        font-size: 12px;
        font-weight: 600;
        color: #f0f6fc;
      }
      .wifi-state-detail {
        font-size: 10px;
        color: #8b949e;
      }
      .wifi-state-ap-count {
        font-size: 9px;
        color: #6e7681;
        background: rgba(0, 0, 0, 0.2);
        padding: 2px 6px;
        border-radius: 10px;
      }
      .wifi-log-toggle {
        border: 1px solid rgba(255, 255, 255, 0.15);
        background: rgba(13, 17, 23, 0.6);
        color: #8b949e;
        width: 30px;
        height: 30px;
        border-radius: 6px;
        display: flex;
        align-items: center;
        justify-content: center;
        cursor: pointer;
        transition: all 0.2s ease;
        margin-left: 8px;
        position: relative;
      }
      .wifi-log-toggle.active {
        color: #baff61;
        border-color: #baff61;
        box-shadow: 0 0 8px rgba(186, 255, 97, 0.3);
      }
      .wifi-log-toggle.has-updates::after {
        content: "";
        position: absolute;
        width: 6px;
        height: 6px;
        border-radius: 50%;
        background: #ff6b6b;
        top: 4px;
        right: 4px;
      }
      /* Nearby APs list (inside expandable Wi-Fi banner) */
      .nearby-aps-list {
        display: flex;
        flex-direction: column;
        gap: 4px;
        margin-top: 8px;
      }
      .nearby-ap-item {
        display: flex;
        align-items: center;
        gap: 6px;
        padding: 4px 8px;
        background: #0d1117;
        border: 1px solid #30363d;
        border-radius: 4px;
        font-family: ui-monospace, monospace;
        font-size: 10px;
      }
      .nearby-ap-item.current {
        border-color: #58a6ff;
        background: rgba(88, 166, 255, 0.1);
      }
      .nearby-ap-item.better {
        border-color: #3fb950;
        background: rgba(63, 185, 80, 0.1);
        animation: pulse-better 2s ease-in-out infinite;
      }
      @keyframes pulse-better {
        0%,
        100% {
          opacity: 1;
        }
        50% {
          opacity: 0.7;
        }
      }
      .ap-bssid {
        color: #8b949e;
        flex: 1;
      }
      .ap-rssi {
        font-weight: 600;
        min-width: 50px;
        text-align: right;
      }
      .ap-rssi.good {
        color: #3fb950;
      }
      .ap-rssi.medium {
        color: #e3b341;
      }
      .ap-rssi.bad {
        color: #f85149;
      }
      .ap-indicator {
        font-size: 10px;
        padding: 2px 6px;
        border-radius: 3px;
        text-transform: uppercase;
        font-weight: 600;
      }
      .ap-indicator.current {
        background: rgba(88, 166, 255, 0.2);
        color: #58a6ff;
      }
      .ap-indicator.better {
        background: rgba(63, 185, 80, 0.2);
        color: #3fb950;
      }
      /* Rescan button */
      .rescan-btn {
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 6px;
        width: 100%;
        margin-top: 8px;
        padding: 8px 12px;
        background: #21262d;
        border: 1px solid #30363d;
        border-radius: 6px;
        color: #8b949e;
        font-size: 11px;
        font-weight: 500;
        cursor: pointer;
        transition: all 0.2s;
      }
      .rescan-btn:hover {
        background: #30363d;
        border-color: #444c56;
        color: #e6edf3;
      }
      .rescan-btn:active {
        transform: scale(0.98);
      }
      .rescan-btn.scanning {
        pointer-events: none;
        opacity: 0.7;
      }
      .rescan-btn.scanning i {
        animation: spin 1s linear infinite;
      }
      @keyframes spin {
        from {
          transform: rotate(0deg);
        }
        to {
          transform: rotate(360deg);
        }
      }
      .rescan-btn.disabled {
        opacity: 0.4;
        cursor: not-allowed;
        pointer-events: none;
      }
      /* Better AP available banner */
      .better-ap-banner {
        display: none;
        align-items: center;
        gap: 8px;
        padding: 8px 12px;
        background: rgba(63, 185, 80, 0.15);
        border: 1px solid #3fb950;
        border-radius: 6px;
        margin-top: 8px;
        font-size: 12px;
        color: #3fb950;
      }
      .better-ap-banner.visible {
        display: flex;
      }
      .better-ap-banner i {
        font-size: 16px;
      }
      /* Motor inhibition overlay on joystick */
      .motor-inhibited-overlay {
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: rgba(248, 81, 73, 0.3);
        border-radius: 50%;
        display: none;
        align-items: center;
        justify-content: center;
        flex-direction: column;
        gap: 8px;
        z-index: 50;
        pointer-events: none;
      }
      .motor-inhibited-overlay.visible {
        display: flex;
      }
      .motor-inhibited-icon {
        font-size: 48px;
        color: #f85149;
      }
      .motor-inhibited-text {
        font-size: 14px;
        font-weight: 600;
        color: #f85149;
        text-transform: uppercase;
      }
      .diag-unit {
        font-size: 10px;
        color: #6e7681;
        margin-left: 2px;
      }
      .mobile-splitter {
        display: none;
        height: 24px;
        background: #161b22;
        border-top: 1px solid #30363d;
        border-bottom: 1px solid #30363d;
        cursor: ns-resize;
        touch-action: none;
        user-select: none;
        position: relative;
      }
      .mobile-splitter::after {
        content: "";
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        width: 40px;
        height: 4px;
        background: #444c56;
        border-radius: 2px;
      }
      @media (max-width: 768px) {
        body {
          overflow: auto;
        }
        /* Compact header for mobile */
        .header {
          padding: 6px 12px;
          flex-direction: row;
          flex-wrap: wrap;
          gap: 6px;
        }
        .header-left {
          flex: 1;
          flex-wrap: wrap;
          gap: 6px;
        }
        .header-left h1 {
          display: none; /* Hide title on mobile to save space */
        }
        .header-right {
          display: none; /* Hide WS status on mobile */
        }
        .role-badge {
          font-size: 10px;
          padding: 4px 8px;
        }
        .header-actions {
          flex-wrap: nowrap;
        }
        .header-btn {
          font-size: 10px;
          padding: 4px 8px;
        }

        /* Mobile layout: video -> joystick -> knobs */
        .main-grid {
          display: flex;
          flex-direction: column;
          gap: 8px;
          padding: 8px;
          overflow: visible;
        }

        /* Camera takes priority - flexible height */
        .camera-section {
          order: 1;
          min-height: 35vh;
          max-height: 45vh;
          flex-shrink: 0;
          padding: 0;
          position: relative;
        }
        .video-container {
          border-radius: 8px;
        }

        /* Diagnostics becomes tiny pill overlay on video (when moved by JS) */
        .diagnostics-section.mobile-overlay {
          position: absolute;
          top: 6px;
          left: 6px;
          z-index: 80;
          background: transparent;
          border: none;
          padding: 0;
        }
        /* Hide regular diagnostics section in grid on mobile */
        .diagnostics-section:not(.mobile-overlay) {
          display: none;
        }
        /* Hide all diag grids and control grids on mobile */
        .diagnostics-section.mobile-overlay .diag-grid,
        .diagnostics-section.mobile-overlay .control-grid {
          display: none;
        }
        /* Make Wi-Fi banner a tiny pill on mobile */
        .diagnostics-section.mobile-overlay .wifi-state-banner {
          display: inline-flex;
          padding: 0;
          margin: 0;
          border-radius: 12px;
          background: rgba(0, 0, 0, 0.6);
          backdrop-filter: blur(4px);
          border: 1px solid rgba(255, 255, 255, 0.1);
        }
        .diagnostics-section.mobile-overlay .wifi-state-header {
          padding: 4px 10px;
          gap: 6px;
        }
        .diagnostics-section.mobile-overlay .wifi-state-icon {
          font-size: 12px;
          width: auto;
        }
        .diagnostics-section.mobile-overlay .wifi-state-info {
          display: flex;
          align-items: center;
          gap: 6px;
        }
        .diagnostics-section.mobile-overlay .wifi-state-label {
          font-size: 10px;
          font-weight: 500;
        }
        .diagnostics-section.mobile-overlay .wifi-state-detail {
          font-size: 9px;
          color: rgba(255, 255, 255, 0.95);
          font-weight: 500;
        }
        /* Hide expandable parts on mobile */
        .diagnostics-section.mobile-overlay .wifi-state-details,
        .diagnostics-section.mobile-overlay .wifi-state-expand,
        .diagnostics-section.mobile-overlay .wifi-state-ap-count {
          display: none;
        }
        /* Color adjustments for mobile overlay */
        .diagnostics-section.mobile-overlay .wifi-state-banner.ok {
          background: rgba(46, 160, 67, 0.7);
          border-color: rgba(63, 185, 80, 0.5);
        }
        .diagnostics-section.mobile-overlay
          .wifi-state-banner.ok
          .wifi-state-icon,
        .diagnostics-section.mobile-overlay
          .wifi-state-banner.ok
          .wifi-state-label {
          color: #fff;
        }
        .diagnostics-section.mobile-overlay .wifi-state-banner.degraded {
          background: rgba(210, 153, 34, 0.8);
          border-color: rgba(227, 179, 65, 0.5);
        }
        .diagnostics-section.mobile-overlay
          .wifi-state-banner.degraded
          .wifi-state-icon,
        .diagnostics-section.mobile-overlay
          .wifi-state-banner.degraded
          .wifi-state-label {
          color: #fff;
        }
        .diagnostics-section.mobile-overlay .wifi-state-banner.roaming {
          background: rgba(227, 116, 50, 0.8);
          border-color: rgba(240, 136, 62, 0.5);
        }
        .diagnostics-section.mobile-overlay
          .wifi-state-banner.roaming
          .wifi-state-icon,
        .diagnostics-section.mobile-overlay
          .wifi-state-banner.roaming
          .wifi-state-label {
          color: #fff;
        }
        .diagnostics-section.mobile-overlay .wifi-state-banner.offline {
          background: rgba(248, 81, 73, 0.8);
          border-color: rgba(248, 81, 73, 0.5);
        }
        .diagnostics-section.mobile-overlay
          .wifi-state-banner.offline
          .wifi-state-icon,
        .diagnostics-section.mobile-overlay
          .wifi-state-banner.offline
          .wifi-state-label {
          color: #fff;
        }

        /* Joystick section - second priority */
        .joystick-section {
          order: 2;
          padding: 12px;
        }
        .light-controls {
          top: 8px;
          right: 8px;
          gap: 8px;
        }
        .audio-controls {
          top: 8px;
          left: 8px;
          gap: 8px;
        }
        .light-btn,
        .audio-btn {
          width: 44px;
          height: 44px;
        }
        .light-btn i,
        .audio-btn i {
          font-size: 18px;
        }
        .light-btn-label {
          font-size: 8px;
          bottom: 4px;
        }
        .joystick {
          width: 200px;
          height: 200px;
        }
        .joystick-base,
        .joystick-handle {
          width: 70px;
          height: 70px;
          margin: -35px 0 0 -35px;
        }
        .motor-values {
          gap: 16px;
        }
        .motor-num {
          font-size: 16px;
        }

        /* Knobs section - last */
        .controls-section.knobs-container {
          order: 3;
          padding: 12px;
        }
        .knobs-section {
          gap: 12px;
        }
        .knob {
          width: 50px;
          height: 50px;
        }
        .knob-indicator {
          top: 6px;
          height: 16px;
          transform-origin: center 19px;
        }
        .knob-label {
          font-size: 9px;
        }
        .knob-value {
          font-size: 10px;
        }

        /* Hide mobile splitter */
        .mobile-splitter {
          display: none;
        }
        .log-section {
          display: none;
        }
      }

      /* Extra small screens (phones in portrait) */
      @media (max-width: 480px) {
        .joystick {
          width: 180px;
          height: 180px;
        }
        .joystick-base,
        .joystick-handle {
          width: 60px;
          height: 60px;
          margin: -30px 0 0 -30px;
        }
        .knob {
          width: 44px;
          height: 44px;
        }
        .knob-indicator {
          top: 5px;
          height: 14px;
          transform-origin: center 17px;
        }
        .camera-section {
          min-height: 30vh;
          max-height: 40vh;
        }
      }
    </style>
  </head>
  <body>
    <div class="header">
      <div class="header-left">
        <h1>Rover Control</h1>
        <div
          class="role-badge spectator"
          id="roleStatus"
        >
          <i
            class="fa-light fa-eye role-icon"
            id="roleIcon"
          ></i>
          <span id="roleText">Connecting...</span>
        </div>
        <div class="header-actions">
          <button
            class="header-btn claim hidden"
            id="claimBtn"
          >
            <i class="fa-light fa-gamepad"></i>
            <span>Take Control</span>
          </button>
          <button
            class="header-btn request hidden"
            id="requestBtn"
          >
            <i class="fa-light fa-hand"></i>
            <span>Request</span>
            <div
              class="cooldown-bar"
              id="cooldownBar"
            ></div>
          </button>
          <button
            class="header-btn release hidden"
            id="releaseBtn"
          >
            <i class="fa-light fa-hand-holding"></i>
            <span>Release</span>
          </button>
        </div>
      </div>
      <div class="header-right">
        <div
          class="status"
          id="status"
        >
          WS: connecting...
        </div>
      </div>
    </div>

    <div class="main-grid">
      <div class="camera-section">
        <div class="video-container">
          <iframe
            id="cameraFeed"
            allow="autoplay; fullscreen; microphone; camera"
          ></iframe>
          <div
            class="disconnect-overlay"
            id="disconnectOverlay"
          >
            <div class="disconnect-icon">
              <i class="fa-light fa-wifi-slash"></i>
            </div>
            <div class="disconnect-title">Disconnected</div>
            <div
              class="disconnect-status"
              id="disconnectStatus"
            >
              Reconnecting...
            </div>
          </div>
          <div
            class="request-overlay"
            id="requestOverlay"
          >
            <div class="request-overlay-title">
              <i class="fa-light fa-hand"></i>
              <span id="requestFromName">Someone</span> wants control
            </div>
            <div class="request-overlay-actions">
              <button
                class="request-overlay-btn accept"
                id="acceptBtn"
              >
                <i class="fa-light fa-check"></i>
                Accept
              </button>
              <button
                class="request-overlay-btn deny"
                id="denyBtn"
              >
                <i class="fa-light fa-xmark"></i>
                Deny
              </button>
            </div>
          </div>
          <div
            class="log-overlay"
            id="logOverlay"
          >
            <div
              class="log-overlay-inner"
              id="logOverlayInner"
            ></div>
          </div>
        </div>
      </div>

      <div
        class="mobile-splitter"
        id="mobileSplitter"
      ></div>

      <div class="diagnostics-section">
        <!-- Wi-Fi Safety State Indicator - Expandable -->
        <div
          class="wifi-state-banner"
          id="wifiStateBanner"
        >
          <div
            class="wifi-state-header"
            id="wifiStateHeader"
          >
            <div class="wifi-state-icon">
              <i
                class="fa-light fa-wifi"
                id="wifiStateIcon"
              ></i>
            </div>
            <div class="wifi-state-info">
              <div
                class="wifi-state-label"
                id="wifiStateLabel"
              >
                Connecting...
              </div>
              <div
                class="wifi-state-detail"
                id="wifiStateDetail"
              ></div>
            </div>
            <span
              class="wifi-state-ap-count"
              id="wifiApCount"
              >0 APs</span
            >
            <button
              class="wifi-log-toggle"
              id="wifiLogToggle"
              type="button"
              title="Toggle rover log overlay"
            >
              <i class="fa-light fa-terminal"></i>
            </button>
            <i class="fa-light fa-chevron-down wifi-state-expand"></i>
          </div>
          <div class="wifi-state-details">
            <div class="wifi-state-details-inner">
              <div
                class="diag-grid"
                style="margin-bottom: 8px"
              >
                <div class="diag-card">
                  <div class="diag-label">BSSID</div>
                  <div
                    class="diag-value diag-value-small"
                    id="wifiBssid"
                  >
                    --:--:--
                  </div>
                </div>
                <div class="diag-card">
                  <div class="diag-label">Freq</div>
                  <div class="diag-value">
                    <span id="wifiFreq">--</span
                    ><span class="diag-unit">MHz</span>
                  </div>
                </div>
                <div class="diag-card">
                  <div class="diag-label">TX/RX</div>
                  <div
                    class="diag-value diag-value-small"
                    id="wifiBitrate"
                  >
                    --/--
                  </div>
                </div>
              </div>
              <div
                class="nearby-aps-list"
                id="nearbyApsList"
              >
                <div class="nearby-ap-item">Scanning...</div>
              </div>
              <button
                class="rescan-btn"
                id="rescanBtn"
              >
                <i class="fa-light fa-arrows-rotate"></i>
                <span>Restart Wi-Fi & Roam</span>
              </button>
            </div>
          </div>
        </div>

        <div class="diag-grid">
          <div class="diag-card">
            <div class="diag-label">CPU</div>
            <div class="diag-value">
              <span id="cpuTemp">--</span><span class="diag-unit">Â°C</span>
            </div>
          </div>
          <div class="diag-card">
            <div class="diag-label">RSSI</div>
            <div class="diag-value">
              <span id="wifiRssi">--</span><span class="diag-unit">dBm</span>
            </div>
          </div>
          <div class="diag-card">
            <div class="diag-label">Ping</div>
            <div class="diag-value">
              <span id="pingMs">--</span><span class="diag-unit">ms</span>
            </div>
          </div>
        </div>
      </div>

      <div class="controls-section joystick-section">
        <!-- Audio controls - left side -->
        <div class="audio-controls">
          <div
            class="audio-btn ptt"
            id="pttBtn"
            title="Push to Talk (hold to speak)"
          >
            <i class="fa-light fa-microphone"></i>
          </div>
          <div
            class="audio-btn mute"
            id="muteBtn"
            title="Mute rover audio"
          >
            <i class="fa-light fa-volume-high"></i>
          </div>
          <div
            class="audio-btn horn"
            id="hornBtn"
            title="Sound horn (1000Hz)"
          >
            <i class="fa-light fa-bullhorn"></i>
          </div>
        </div>

        <!-- Light controls - right side -->
        <div class="light-controls">
          <div
            class="light-btn"
            id="headlightBtn"
            title="Toggle Normal LED"
          >
            <i class="fa-light fa-lightbulb"></i>
            <span class="light-btn-label">LED</span>
          </div>
          <div
            class="light-btn ir"
            id="irLedBtn"
            title="Toggle IR LED"
          >
            <i class="fa-light fa-eye-slash"></i>
            <span class="light-btn-label">IR</span>
          </div>
        </div>

        <div
          class="joystick"
          id="joystick"
        >
          <div class="joystick-base"></div>
          <div
            class="joystick-handle"
            id="joystick-handle"
          ></div>
          <div
            class="motor-inhibited-overlay"
            id="motorInhibitedOverlay"
          >
            <i class="fa-light fa-hand motor-inhibited-icon"></i>
            <div
              class="motor-inhibited-text"
              id="motorInhibitedText"
            >
              STOPPED
            </div>
          </div>
        </div>

        <div class="motor-values">
          <div class="motor-value">
            <div class="motor-label">Left</div>
            <div
              class="motor-num"
              id="leftValue"
            >
              0
            </div>
          </div>
          <div class="motor-value">
            <div class="motor-label">Right</div>
            <div
              class="motor-num"
              id="rightValue"
            >
              0
            </div>
          </div>
        </div>
      </div>

      <div class="controls-section knobs-container">
        <div class="knobs-section">
          <div class="knob-container">
            <div
              class="knob"
              id="maxVelKnob"
            >
              <div class="knob-circle">
                <div
                  class="knob-indicator"
                  id="maxVelIndicator"
                ></div>
              </div>
            </div>
            <div class="knob-label">Max Speed</div>
            <div
              class="knob-value"
              id="maxVelValue"
            >
              100%
            </div>
          </div>

          <div class="knob-container">
            <div
              class="knob"
              id="spinSpeedKnob"
            >
              <div class="knob-circle">
                <div
                  class="knob-indicator"
                  id="spinSpeedIndicator"
                ></div>
              </div>
            </div>
            <div class="knob-label">Spin Speed</div>
            <div
              class="knob-value"
              id="spinSpeedValue"
            >
              50%
            </div>
          </div>

          <div class="knob-container">
            <div
              class="knob"
              id="turnKnob"
            >
              <div class="knob-circle">
                <div
                  class="knob-indicator"
                  id="turnIndicator"
                ></div>
              </div>
            </div>
            <div class="knob-label">Turn Zone</div>
            <div
              class="knob-value"
              id="turnValue"
            >
              15%
            </div>
          </div>

          <div class="knob-container">
            <div
              class="knob"
              id="spinKnob"
            >
              <div class="knob-circle">
                <div
                  class="knob-indicator"
                  id="spinIndicator"
                ></div>
              </div>
            </div>
            <div class="knob-label">Spin Zone</div>
            <div
              class="knob-value"
              id="spinValue"
            >
              15%
            </div>
          </div>
        </div>

        <div class="knobs-section">
          <div class="knob-container">
            <div
              class="knob"
              id="fwdKnob"
            >
              <div class="knob-circle">
                <div
                  class="knob-indicator"
                  id="fwdIndicator"
                ></div>
              </div>
            </div>
            <div class="knob-label">Fwd Trim</div>
            <div
              class="knob-value"
              id="fwdValue"
            >
              0
            </div>
          </div>

          <div class="knob-container">
            <div
              class="knob"
              id="revKnob"
            >
              <div class="knob-circle">
                <div
                  class="knob-indicator"
                  id="revIndicator"
                ></div>
              </div>
            </div>
            <div class="knob-label">Rev Trim</div>
            <div
              class="knob-value"
              id="revValue"
            >
              0
            </div>
          </div>
        </div>
      </div>
    </div>

    <script src="/app.js?v=1.2.3"></script>
  </body>
</html>
